var COORDINATE_LENGTH=5e4,Star=function(t,r,o,a){this.x=t,this.y=r,this.size=o,this.color=a};Star.prototype.mapXYToCanvasCoordinates=function(t,r){var o=Math.round(this.x/COORDINATE_LENGTH*t),a=Math.round(this.y/COORDINATE_LENGTH*r);return{x:o,y:a}};for(var StarFactory={getRandomStar:function(){var t=Math.floor(Math.random()*(COORDINATE_LENGTH+1)),r=Math.floor(Math.random()*(COORDINATE_LENGTH+1)),o=this._getWeightedRandomSize(),a=this._getWeightedRandomColor(),e=this._applyRandomShade(a);return new Star(t,r,o,this._getRGBColorString(e))},_getWeightedRandomSize:function(){var t=[1,1.5,2],r=[.8,.15,.05];return this._getWeightedRandom(t,r)},_getWeightedRandomColor:function(){var t=[{r:255,g:189,b:111},{r:255,g:221,b:180},{r:255,g:244,b:232},{r:251,g:248,b:255},{r:202,g:216,b:255},{r:170,g:191,b:255},{r:155,g:176,b:255}],r=[.05,.05,.05,.7,.05,.05,.05];return this._getWeightedRandom(t,r)},_getRandomShade:function(){var t=[.4,.6,1],r=[.5,.3,.2];return this._getWeightedRandom(t,r)},_applyRandomShade:function(t){var r=this._getRandomShade();return 1!==r&&(t.r=Math.floor(t.r*r),t.g=Math.floor(t.g*r),t.b=Math.floor(t.b*r)),t},_getRGBColorString:function(t){return"rgb("+t.r+","+t.g+","+t.b+")"},_getWeightedRandom:function(t,r){for(var o=function(t,r){return Math.random()*(r-t)+t},a=r.reduce(function(t,r){return t+r}),e=o(0,a),n=0,i=0;i<t.length;i++)if(n+=r[i],n=+n.toFixed(2),e<=n)return t[i]}},deltaX=8,Starfield=[],i=0;i<500;i++)Starfield.push(StarFactory.getRandomStar());
"use strict";function rand(t,e){return Math.random()*(e-t)+t}var c,cx,width,height,points,count,Mute=!1,single=!0,stop=!1,player,speed=15,score,result,numPoints,smoke,gravity=.1,thrust=.4,animationFrameId,tau=2*Math.PI,sectionWidth=20,dis=0,block=!0,timer,caveHeight,groundHeight,distance,resetSwitch=document.getElementsByClassName("reset"),startMessage=document.getElementById("start"),startButton=document.getElementById("startBtn"),gameOverMessage=document.getElementById("gameover"),dir=document.getElementById("dir"),mute=document.getElementById("button");resetSwitch.onclick=function(t){t.preventDefault(),init(),loop()},startButton.onclick=function(t){t.preventDefault(),startMessage.innerHTML="",dir.innerHTML="",loop(),oB.singLoop("game"),oB.cancel("start")},mute.onclick=function(){oB.muteToggle(),Mute=!Mute};var SmokeParticle=function(){function t(t,e){this.x=t,this.y=e,this.radius=rand(2,6),block?(this.dx=rand(-.5,.5),this.dy=rand(1,4)):(this.dy=rand(-.5,.5),this.dx=rand(1,4)),this.age=0,this.lifeSpan=rand(20,60),this.colours=newColours()}return t.prototype.draw=function(){cx.beginPath(),cx.arc(this.x,this.y,this.radius,0,tau),cx.fillStyle="rgba("+this.colours.r+","+this.colours.g+","+this.colours.b+", 1)",cx.fill()},t.prototype.step=function(){if(block){this.dy+=2*gravity;var t=groundYatX(this.x)+caveHeight;this.y>=t+dis&&(this.dy*=-1,rand(0,1)>.5?this.dx+=3:this.dx-=3),this.x+=this.dx,this.y+=this.dy}else this.dx+=2*gravity,rand(0,1)>.5?this.dy+=.1:this.dy-=.1,this.x-=this.dx,this.y+=this.dy;this.age++},t}(),addSmokeParticle=function(t){var e=t;if(block)for(var t=0;t<e;t++){var i=rand(0,1),o=0;smoke.push(new SmokeParticle(player.x+i,player.y+player.radius+o))}else for(var t=0;t<e;t++){var o=rand(0,1),i=0;smoke.push(new SmokeParticle(player.x-player.radius,player.y+o))}},Player=function(){function t(t,e){this.x=t,this.y=e,this.dy=0,this.radius=15,this.colours=newColours()}return t.prototype.draw=function(){cx.beginPath(),cx.arc(this.x,this.y,this.radius,0,tau),cx.fillStyle="rgba("+this.colours.r+","+this.colours.g+","+this.colours.b+", 1)",cx.fill()},t.prototype.step=function(){this.y+=this.dy,this.dy+=gravity},t.prototype.boost=function(){block?(addSmokeParticle(50),oB.sing("boost"),this.dy-=thrust):addSmokeParticle(10)},t}(),Point=function(){function t(t,e){this.radius=2,this.colours=newColours(),this.x=t,this.y=e}return t.prototype.draw=function(){cx.beginPath(),cx.arc(this.x,this.y-dis,this.radius,0,tau),cx.fillStyle="rgba("+this.colours.r+","+this.colours.g+","+this.colours.b+", 1)",cx.fill(),cx.beginPath(),cx.arc(this.x,this.y+caveHeight+dis,this.radius,0,tau),cx.fillStyle="rgba("+this.colours.r+","+this.colours.g+","+this.colours.b+", 1)",cx.fill()},t}(),drawLines=function(){for(var t=0;t<points.length;t++)if(t<points.length-1){var e=points[t],i=points[t+1],o=newColours();cx.beginPath(),cx.moveTo(e.x,e.y-dis),cx.lineTo(i.x,i.y-dis),cx.lineWidth=1,cx.strokeStyle="rgba("+o.r+","+o.g+","+o.b+", 1)",cx.stroke(),cx.beginPath(),cx.moveTo(e.x,e.y+caveHeight+dis),cx.lineTo(i.x,i.y+caveHeight+dis),cx.lineWidth=1,cx.strokeStyle="rgba("+o.r+","+o.g+","+o.b+", 1)",cx.stroke()}},newColours=function(){var t=Math.floor(rand(0,128)),e=Math.floor(rand(0,64)),i=Math.floor(rand(128,255));return{r:t,g:e,b:i}},groundYatX=function(t){for(var e=0;e<points.length;e++){var i=points[e];if(t<i.x+sectionWidth&&t>i.x-sectionWidth)return i.y}},gameOver=function(){window.cancelAnimationFrame(animationFrameId),gameOverMessage.innerHTML="<h1>Game Over</h1><h2>Distance: "+Math.floor(distance/10)+"</h2>"},checkCollision=function(){var t=groundYatX(player.x);(player.y-player.radius<=t-dis||player.y+player.radius>=t+caveHeight+dis)&&(single=!1,stop=!0,oB.cancel("game"),oB.cancel("thrust"),gameOver(),oB.sing("die"),checkScore())},checkScore=function(){localStorage.highScore?(result=localStorage.highScore,localStorage.highScore<score&&(localStorage.highScore=score)):(localStorage.highScore=0,result=0)},recalcMovement=function(){for(var t=0;t<Starfield.length-1;t++){var e=Starfield[t].x-deltaX;e<0&&(e+=COORDINATE_LENGTH),e>COORDINATE_LENGTH&&(e-=COORDINATE_LENGTH),Starfield[t].x=e}},drawing=function(){cx.clearRect(0,0,width,height),cx.fillStyle="black",cx.fillRect(0,0,width,height);for(var t=0;t<Starfield.length;t++){var e=Starfield[t].mapXYToCanvasCoordinates(width,height);cx.fillStyle=Starfield[t].color,t%9!==0?cx.fillRect(e.x,e.y,Starfield[t].size,Starfield[t].size):(Starfield[t].size>2?Starfield[t].size=.8:Starfield[t].size+=.02,cx.fillRect(e.x,e.y,Starfield[t].size,Starfield[t].size))}},loop=function(){block?distance++:distance+=5;var t=document.getElementById("details");groundYatX(player.x);if(score=Math.floor(distance/10),t.innerHTML="highScore: "+result+"  Distance: "+score,animationFrameId=window.requestAnimationFrame(loop),cx.clearRect(0,0,width,height),document.onkeydown=function(t){32==t.keyCode&&(stop||player.boost(),player.dy=-rand(2,4)),37==t.keyCode&&(block=!0,speed=15,oB.cancel("thrust"),deltaX=10,stop||(single=!0)),38==t.keyCode&&dis++,39==t.keyCode&&(block=!1,speed=30,deltaX=100,single&&oB.singLoop("thrust"),single=!1),40==t.keyCode&&dis--},document.onkeyup=function(t){32==t.keyCode&&addSmokeParticle(50)},block||player.boost(),0===points.length||points[points.length-1].x<=width-sectionWidth){var e=width,i=noise.simplex2(count,count);count+=.05;var o=50*i+groundHeight;points.push(new Point(e,o)),points.length>numPoints&&points.shift()}drawing(),recalcMovement();for(var r=0;r<points.length;r++){var n=points[r];n.x-=speed,n.draw()}drawLines(),player.step(),player.draw();for(var s=0;s<smoke.length;s++){var a=smoke[s];a.step(),a.draw(),a.age>=a.lifeSpan&&smoke.shift()}checkCollision()},init=function(){checkScore(),oB.singLoop("start"),c=document.querySelector("canvas"),width=c.width=window.innerWidth,height=c.height=window.innerHeight,cx=c.getContext("2d"),window.addEventListener("resize",function(){width=c.width=window.innerWidth,height=c.height=window.innerHeight},!1),count=0,distance=0,caveHeight=height/3,groundHeight=(height-caveHeight)/2,points=[],smoke=[],gameOverMessage.innerHTML="",numPoints=Math.ceil(2*width/sectionWidth),player=new Player(width/2,height/4)};init();
!function(t){function o(t,o,r){this.x=t,this.y=o,this.z=r}function r(t){return t*t*t*(t*(6*t-15)+10)}function n(t,o,r){return(1-r)*t+r*o}var a=t.noise={};o.prototype.dot2=function(t,o){return this.x*t+this.y*o},o.prototype.dot3=function(t,o,r){return this.x*t+this.y*o+this.z*r};var e=[new o(1,1,0),new o(-1,1,0),new o(1,-1,0),new o(-1,-1,0),new o(1,0,1),new o(-1,0,1),new o(1,0,-1),new o(-1,0,-1),new o(0,1,1),new o(0,-1,1),new o(0,1,-1),new o(0,-1,-1)],i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],d=new Array(512),f=new Array(512);a.seed=function(t){t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8);for(var o=0;o<256;o++){var r;r=1&o?i[o]^255&t:i[o]^t>>8&255,d[o]=d[o+256]=r,f[o]=f[o+256]=e[r%12]}},a.seed(0);var h=.5*(Math.sqrt(3)-1),v=(3-Math.sqrt(3))/6,u=1/3,s=1/6;a.simplex2=function(t,o){var r,n,a,e,i,u=(t+o)*h,s=Math.floor(t+u),l=Math.floor(o+u),w=(s+l)*v,M=t-s+w,c=o-l+w;M>c?(e=1,i=0):(e=0,i=1);var p=M-e+v,y=c-i+v,x=M-1+2*v,m=c-1+2*v;s&=255,l&=255;var q=f[s+d[l]],z=f[s+e+d[l+i]],A=f[s+1+d[l+1]],b=.5-M*M-c*c;b<0?r=0:(b*=b,r=b*b*q.dot2(M,c));var g=.5-p*p-y*y;g<0?n=0:(g*=g,n=g*g*z.dot2(p,y));var j=.5-x*x-m*m;return j<0?a=0:(j*=j,a=j*j*A.dot2(x,m)),70*(r+n+a)},a.simplex3=function(t,o,r){var n,a,e,i,h,v,l,w,M,c,p=(t+o+r)*u,y=Math.floor(t+p),x=Math.floor(o+p),m=Math.floor(r+p),q=(y+x+m)*s,z=t-y+q,A=o-x+q,b=r-m+q;z>=A?A>=b?(h=1,v=0,l=0,w=1,M=1,c=0):z>=b?(h=1,v=0,l=0,w=1,M=0,c=1):(h=0,v=0,l=1,w=1,M=0,c=1):A<b?(h=0,v=0,l=1,w=0,M=1,c=1):z<b?(h=0,v=1,l=0,w=0,M=1,c=1):(h=0,v=1,l=0,w=1,M=1,c=0);var g=z-h+s,j=A-v+s,k=b-l+s,B=z-w+2*s,C=A-M+2*s,D=b-c+2*s,E=z-1+3*s,F=A-1+3*s,G=b-1+3*s;y&=255,x&=255,m&=255;var H=f[y+d[x+d[m]]],I=f[y+h+d[x+v+d[m+l]]],J=f[y+w+d[x+M+d[m+c]]],K=f[y+1+d[x+1+d[m+1]]],L=.6-z*z-A*A-b*b;L<0?n=0:(L*=L,n=L*L*H.dot3(z,A,b));var N=.6-g*g-j*j-k*k;N<0?a=0:(N*=N,a=N*N*I.dot3(g,j,k));var O=.6-B*B-C*C-D*D;O<0?e=0:(O*=O,e=O*O*J.dot3(B,C,D));var P=.6-E*E-F*F-G*G;return P<0?i=0:(P*=P,i=P*P*K.dot3(E,F,G)),32*(n+a+e+i)},a.perlin2=function(t,o){var a=Math.floor(t),e=Math.floor(o);t-=a,o-=e,a&=255,e&=255;var i=f[a+d[e]].dot2(t,o),h=f[a+d[e+1]].dot2(t,o-1),v=f[a+1+d[e]].dot2(t-1,o),u=f[a+1+d[e+1]].dot2(t-1,o-1),s=r(t);return n(n(i,v,s),n(h,u,s),r(o))},a.perlin3=function(t,o,a){var e=Math.floor(t),i=Math.floor(o),h=Math.floor(a);t-=e,o-=i,a-=h,e&=255,i&=255,h&=255;var v=f[e+d[i+d[h]]].dot3(t,o,a),u=f[e+d[i+d[h+1]]].dot3(t,o,a-1),s=f[e+d[i+1+d[h]]].dot3(t,o-1,a),l=f[e+d[i+1+d[h+1]]].dot3(t,o-1,a-1),w=f[e+1+d[i+d[h]]].dot3(t-1,o,a),M=f[e+1+d[i+d[h+1]]].dot3(t-1,o,a-1),c=f[e+1+d[i+1+d[h]]].dot3(t-1,o-1,a),p=f[e+1+d[i+1+d[h+1]]].dot3(t-1,o-1,a-1),y=r(t),x=r(o),m=r(a);return n(n(n(v,w,y),n(u,M,y),m),n(n(s,c,y),n(l,p,y),m),x)}}(this);
function Buzz(o){this.json=o,this.arr=[]}var oA,json={die:"sound/die.mp3",start:"sound/startSound.mp3",boost:"sound/boost.mp3",thrust:"sound/cc.mp3",game:"sound/gameBackground.mp3"},oB=new Buzz(json);Buzz.prototype.sound=function(o){for(var r in o)oA=new Audio,oA.src=o[r],oA.play(),this.arr.push(oA)},Buzz.prototype.sing=function(o){oA=new Audio,oA.src=json[o],Mute?oA.volume=0:oA.volume=.3,oA.play(),this.arr.push(oA)},Buzz.prototype.muteToggle=function(){if(Mute)for(var o=0;o<this.arr.length;o++)this.arr[o].volume=.3;else for(var o=0;o<this.arr.length;o++)this.arr[o].volume=0},Buzz.prototype.cancel=function(o){for(var r=0;r<this.arr.length;r++)this.arr[r].src.indexOf(this.json[o])!=-1&&(this.arr[r].pause(),this.arr.splice(r,1))},Buzz.prototype.singLoop=function(o){oA=new Audio,oA.src=json[o],Mute?oA.volume=0:oA.volume=.3,oA.loop="loop",oA.play(),this.arr.push(oA)};